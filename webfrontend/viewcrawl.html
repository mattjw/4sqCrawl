<!DOCTYPE html> 
<html> 

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>Fourcrawl</title> 
        <meta name="description" content="Fourcrawl - the foursquare pub crawl manager">
        
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0b3/jquery.mobile-1.0b3.min.css" />
        
	<script src="http://code.jquery.com/jquery-1.6.3.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.0b3/jquery.mobile-1.0b3.min.js"></script>
        <script src="js/jquery.ba-bbq.min.js"></script>    
        <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script> 


<script type="text/javascript">      
    
  var token;
  var directionDisplay;

  var selectedvenues = [];
  var selectedMarkers = [];
  var routes = [];
  var route_lines = [];

  $(document).ready(function(){
      
    var client_id  = 'VFS1NOYWSKC3THKFSP5VNFE1CLLED5CU0LMFUYWKCTB3IZBO';
    var callback_url    = 'http://localhost/~martin/mobile.html';

    var initialLocation;
    var cardiff = new google.maps.LatLng(51.481307,-3.18049860);
    var browserSupportFlag =  new Boolean();



    if ($.bbq.getState('access_token')) 
    {

      // Try W3C Geolocation (Preferred)
      if(navigator.geolocation) 
      {
        browserSupportFlag = true;
        navigator.geolocation.getCurrentPosition(function(position) {
          initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
         
          
        }, function() {
                handleNoGeolocation(browserSupportFlag);
          });
      }

      // Try Google Gears Geolocation
      else if (google.gears) {
        browserSupportFlag = true;
        var geo = google.gears.factory.create('beta.geolocation');
        geo.getCurrentPosition(function(position) {
          initialLocation = new google.maps.LatLng(position.latitude,position.longitude);
          
        }, function() {
            handleNoGeoLocation(browserSupportFlag);
           });
      }

      // Browser doesn't support Geolocation
      else {
        browserSupportFlag = false;
        handleNoGeolocation(browserSupportFlag);
      }

      function handleNoGeolocation(errorFlag) 
      {
        if (errorFlag == true) 
        {
          alert("Geolocation service failed.");
          initialLocation = cardiff;
        } 
        else 
        {
          alert("Your browser doesn't support geolocation. We've placed you in Cardiff.");
          initialLocation = cardiff;
        }
      }      
    }
    
    else if ($.bbq.getState('error')) 
    {
      alert('some sort of error');
    } 
    else 
    {
        /* Redirect for foursquare authentication. */
        window.location.href = 'https://foursquare.com/oauth2/authenticate?client_id=' + client_id + '&response_type=token&redirect_uri=' + callback_url;
    } 
    
    
    
    
  })
  
</script>
        
        
<script type="text/javascript">
    
  $(document).ready(function() {

    function listCrawls() {
        var list_url='https://fourcrawl.nomovingparts.net/api/crawl/list/';
        listHtml = '<ul>';
        $.getJSON(list_url, {}, function(data) {
            for(i in data) {
                
                listhtml += '<a id=' + i + ' href="index.html" data-role="button" data-theme="e" data-icon="arrow-r" data-inline="true" \
                       class="ui-btn ui-btn-icon-right ui-btn-corner-all ui-shadow ui-btn-up-e"> \
                        <span class="ui-btn-inner ui-btn-corner-all">\
                        <span class="ui-btn-text">' + data[i]['name'] + '</span>\
                        <span class="ui-icon ui-icon-arrow-r ui-icon-shadow"></span></span></a>';
            }  
        }, 'json');
        listHtml += '</ul>';
        $("#crawlcontent_").html(listHtml);
    }


    $(".crawlslist").click(function(){
        showCrawl($(this).attr('id'));
    });
    
    
    function showCrawl(crawl_id) {
        var list_url='https://fourcrawl.nomovingparts.net/api/crawl/' + crawl_id + '/list/';
        crawlHtml = '';
        
        $.getJSON(list_url, {}, function(data) {
            crawlHtml += '<div id=\"crawldata\">\
                          (<p class=\"name\">' + data['name'] + '</p>\
                          <p class=\"description\">' + data['description'] + '</p>\
                          <p class=\"start date & time\">' + data['startdatetime'] + '</p>\
                          <p class=\"duration\">' + data['duration'] + '</p>\
                          <p class=\"venues\">' + data['venues'] + '</p>\
                          </div>';
        
        
        
        $("#crawlinfo").html(crawlHtml);
    })}


    listCrawls();


  });
</script>

  </head>
  <body>
      
      
    <!-- Start of first page: #one -->
    <div data-role="page" id="allcrawls">

            <div data-role="header">
                    <h1>fourcrawl</h1>
            </div><!-- /header -->

            
            <div data-role="content" id="home"">	
                    <h2>All <span style="color:#008dcb">four<span  style="color:#f89406" class="italics">crawl</span></span> crawls</h2>

                    <div id="crawlcontent">

                        <a href="#example" data-role="button" data-theme="e" data-icon="arrow-r" data-inline="true" 
                           class="ui-btn ui-btn-icon-right ui-btn-corner-all ui-shadow ui-btn-up-e">
                            <span class="ui-btn-inner ui-btn-corner-all"><span class="ui-btn-text">(example) The Swan and Hen</span>
                                <span class="ui-icon ui-icon-arrow-r ui-icon-shadow"></span></span></a>

                    </div>
                    
                    
            </div><!-- /content -->

            
            
            
            
            <div data-role="footer" data-theme="d">
                    <h4><span style="color:#008dcb">four<span  style="color:#f89406" class="italics">crawl</span></span> - mmmm pubs...</h4>
            </div><!-- /footer -->
            
    </div><!-- /page one -->
      
      
      

<!-- Start of second page: #two (attrib: data-theme="a") -->
<div data-role="page" id="example" >
	<div data-role="header">
		<h1>fourcrawl</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<h1>The Swan and Hen</h1>
                	
		<p>Notice that the theme is different for this page because we've added a few <code>data-theme</code> swatch 
                    here to show off how flexible it is. You can add any content or widget to these pages, but we're keeping these simple.</p>	
		
                <p><a href="#one" data-direction="reverse" data-icon="home" data-role="button" data-theme="b">Back to all crawls</a></p>	
		
	</div><!-- /content -->
	
	<div data-role="footer"  data-theme="d">
		<h4><span style="color:#008dcb">four<span  style="color:#f89406" class="italics">crawl</span></span> - mmmm pubs...</h4>
	</div><!-- /footer -->
</div><!-- /page two -->  
      
      
      
      

  </body>
</html>