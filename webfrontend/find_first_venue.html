<!DOCTYPE html><html lang="en">  <head>	    <meta charset="utf-8">    <title>Fourcrawl</title>    <meta name="description" content="Fourcrawl - the foursquare pub crawl manager">    <meta name="author" content="">    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->    <!--[if lt IE 9]>      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>    <![endif]-->    <!-- Le styles -->    <link href="css/bootstrap.min.css" rel="stylesheet">    <link href="css/fourcrawl.css" rel="stylesheet">    	<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>	<script type="text/javascript" src="js/jquery.ba-bbq.min.js"></script>	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>         	    <style type="text/css">      body {        padding-top: 60px;      }    </style>		    <!-- Le fav and touch icons -->    <link rel="shortcut icon" href="images/favicon.ico">    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">  <script type="text/javascript"> var token;     function initialize()     {            var client_id       = 'VFS1NOYWSKC3THKFSP5VNFE1CLLED5CU0LMFUYWKCTB3IZBO';    var callback_url    = 'http://localhost/~chrisjones/find_first_venue.html';       var initialLocation;    var cardiff = new google.maps.LatLng(51.481307,-3.18049860);    var browserSupportFlag =  new Boolean();    var infowindow = new google.maps.InfoWindow;              if ($.bbq.getState('access_token'))       {          token = $.bbq.getState('access_token');          $.bbq.pushState({}, 2);          var myOptions = {            zoom: 14,            mapTypeId: google.maps.MapTypeId.ROADMAP          };          var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);          // Try W3C Geolocation (Preferred)          if(navigator.geolocation)           {            browserSupportFlag = true;            navigator.geolocation.getCurrentPosition(function(position) {              initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);              map.setCenter(initialLocation);              getNearbyVenues(initialLocation);            }, function() {              handleNoGeolocation(browserSupportFlag);              getNearbyVenues(initialLocation);           });          // Try Google Gears Geolocation          } else if (google.gears) {            browserSupportFlag = true;            var geo = google.gears.factory.create('beta.geolocation');            geo.getCurrentPosition(function(position) {              initialLocation = new google.maps.LatLng(position.latitude,position.longitude);              map.setCenter(initialLocation);              getNearbyVenues(initialLocation);            }, function() {              handleNoGeoLocation(browserSupportFlag);              getNearbyVenues(initialLocation);           });          // Browser doesn't support Geolocation          } else {            browserSupportFlag = false;            handleNoGeolocation(browserSupportFlag);            getNearbyVenues(initialLocation);          }          function handleNoGeolocation(errorFlag) {            if (errorFlag == true) {              alert("Geolocation service failed.");              initialLocation = cardiff;            } else {              alert("Your browser doesn't support geolocation. We've placed you in Cardiff.");              initialLocation = cardiff;            }            map.setCenter(initialLocation);          }                }       else if ($.bbq.getState('error'))       {            alert('some sort of error');      }       else       {            /* Redirect for foursquare authentication. */            window.location.href = 'https://foursquare.com/oauth2/authenticate?client_id=' + client_id + '&response_type=token&redirect_uri=' + callback_url;      }                         function getNearbyVenues(location) {        /* Query foursquare API for venue recommendations near the current location. */        $.getJSON('https://api.foursquare.com/v2/venues/search?ll=' + location.lat() + "," + location.lng() + '&categories=4d4b7105d754a06376d81259&oauth_token=' + token, {}, function(data) {          venues = data['response']['groups'][0]['items'];          /* Place marker for each venue. */                              for (var i = 0; i < venues.length; i++) {                          var marker = new google.maps.Marker({              animation: google.maps.Animation.DROP,              position: new google.maps.LatLng(venues[i]['location']['lat'], venues[i]['location']['lng']),              map: map,              title: venues[i]['name']            });                        addInfoWindow(marker, venues[i]);                         }                            })                        function addInfoWindow(marker, venue){                        google.maps.event.addListener(marker, 'click', function(event){                infowindow.close()                infowindow = new google.maps.InfoWindow({                maxHeight: 400,                content:  "<div style='background-image:url(images/bar.png);background-repeat:no-repeat;padding:0 10px 10px 42px;'><h3>" + venue['name'] + "</h3><span>" + venue['location']['address'] + "</span></div><button class='add-venue' id='" + "' style='display:block' class='btn success'>Add place</button>"            });                                                infowindow.open(marker.get('map'), marker);                       });                                        }                          }  }      </script>  </head>  <body onload="initialize();">    <div class="topbar">      <div class="fill">        <div class="container">          <a class="brand" href="#">four<span class="italics">crawl</span></a>          <ul class="nav">            <!-- <li class="active"><a href="#">Home</a></li> -->            <li><a href="#about">About</a></li>            <li><a href="#contact">Contact</a></li>          </ul>        </div>      </div>    </div>	<div id="map_canvas" style="width: 100%; height: 400px;"></div>    <div class="container">    </div> <!-- /container -->			  </body></html>